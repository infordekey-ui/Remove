<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JS Upload Site with JSON Download</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; }
nav { background: #333; color: white; padding: 10px; display:flex; gap: 20px; }
nav a { color:white; text-decoration:none; cursor:pointer; }
nav a.active { text-decoration: underline; }
.container { padding: 20px; }
input, button { padding: 8px; margin:5px 0; }
.file-item { border:1px solid #ccc; padding:5px; margin:5px 0; display:flex; flex-direction: column; }
img.preview { max-width:150px; display:block; margin-top:5px; }
button.download-json { margin-top: 5px; }
</style>
</head>
<body>

<nav>
  <a class="active" data-menu="home">Home</a>
  <a data-menu="shop">Shop</a>
  <a data-menu="item">Item</a>
</nav>

<div class="container">

  <!-- Search -->
  <input type="text" id="searchInput" placeholder="Search by title or filename">

  <!-- Upload Form -->
  <div id="uploadForm">
    <input type="text" id="fileTitle" placeholder="Enter title"><br>
    <input type="file" id="fileInput"><br>
    <button id="uploadBtn">Upload</button>
  </div>

  <!-- Download JSON Button -->
  <button id="downloadJsonBtn">Download All JSON</button>

  <!-- Display uploaded files -->
  <div id="fileList"></div>

</div>

<script>
const menuLinks = document.querySelectorAll('nav a');
const uploadBtn = document.getElementById('uploadBtn');
const fileInput = document.getElementById('fileInput');
const fileTitle = document.getElementById('fileTitle');
const fileList = document.getElementById('fileList');
const searchInput = document.getElementById('searchInput');
const downloadJsonBtn = document.getElementById('downloadJsonBtn');

let filesData = JSON.parse(localStorage.getItem('filesData') || '[]');
let currentMenu = 'home';

// --- Menu Switching ---
menuLinks.forEach(link => {
  link.addEventListener('click', () => {
    menuLinks.forEach(l=>l.classList.remove('active'));
    link.classList.add('active');
    currentMenu = link.dataset.menu;
    renderFiles();
  });
});

// --- Upload File ---
uploadBtn.addEventListener('click', () => {
  const file = fileInput.files[0];
  const title = fileTitle.value.trim();
  if (!file || !title) { alert("Please provide title and file!"); return; }

  const reader = new FileReader();
  reader.onload = function(e) {
    filesData.push({title: title, name: file.name, data: e.target.result, menu: currentMenu});
    localStorage.setItem('filesData', JSON.stringify(filesData));
    fileTitle.value = '';
    fileInput.value = '';
    alert("File uploaded successfully!");
    renderFiles();
  };
  reader.readAsDataURL(file);
});

// --- Render Files ---
function renderFiles() {
  const searchTerm = searchInput.value.toLowerCase();
  const filtered = filesData.filter(f => 
      (f.menu === currentMenu || currentMenu==='home') &&
      (f.title.toLowerCase().includes(searchTerm) || f.name.toLowerCase().includes(searchTerm))
  );

  fileList.innerHTML = '';
  filtered.forEach((f, index) => {
    const div = document.createElement('div');
    div.classList.add('file-item');
    div.innerHTML = `<strong>${f.title}</strong><br>${f.name}<br>`;
    if (f.data.startsWith('data:image')) {
      const img = document.createElement('img');
      img.src = f.data;
      img.classList.add('preview');
      div.appendChild(img);
    }
    // Add per-file download button
    const btn = document.createElement('button');
    btn.innerText = 'Download JSON';
    btn.classList.add('download-json');
    btn.addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(f, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${f.title}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });
    div.appendChild(btn);

    fileList.appendChild(div);
  });
}

// --- Search Input ---
searchInput.addEventListener('input', renderFiles);

// --- Download All JSON ---
downloadJsonBtn.addEventListener('click', () => {
  if (!filesData.length) { alert('No files to download'); return; }
  const blob = new Blob([JSON.stringify(filesData, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `all_files.json`;
  a.click();
  URL.revokeObjectURL(url);
});

// Initial render
renderFiles();
</script>
</body>
</html>
